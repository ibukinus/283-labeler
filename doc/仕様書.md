## 技術スタック
- Runtime: Node.js (v20+)
- Language: TypeScript
- Libraries:
  - @skyware/jetstream (Firehose受信)
  - @skyware/labeler (ラベルサーバー)
  - better-sqlite3 (データベース)
  - dotenv (環境変数管理)

## システム要件とロジック（重要）
1. **DB (SQLite)**
   - テーブル名: `likes`
   - カラム: `did` (TEXT), `rkey` (TEXT), `trigger_uri` (TEXT), `created_at` (INTEGER)
   - 複合主キー: `(did, rkey)`

2. **メモリ内キャッシュ (パフォーマンス対策)**
   - 起動時にDBから全データを読み込み、メモリ上の `Set<string>` に `${did}:${rkey}` の形式でキャッシュする。
   - `app.bsky.feed.like` の `delete` イベントが来た際、まずこのキャッシュを確認する。キャッシュに存在しない場合は即座に処理を終了し、DBアクセスを行わない（負荷対策）。

3. **挙動**
   - **Like作成時 (Create):** 対象投稿が設定されたトリガーURIと一致する場合、DB保存、キャッシュ追加、ラベル付与 (`neg: false`) を行う。
   - **Like削除時 (Delete):** キャッシュに存在する場合のみ、DB検索を行い、対象のラベルを特定してラベル除去 (`neg: true`) を行い、DBとキャッシュから削除する。

4. **LabelerServer**
   - `@skyware/labeler` パッケージの `LabelerServer` クラスを使用。
   - 起動時に指定されたポート（デフォルト: 14831）で待機。
   - `createLabel()` メソッドでラベルの付与・除去を実行。
   - シャットダウン時に適切にクローズ処理を実行。

5. **エラーハンドリング**
   - ラベル発行失敗時はログ出力するが処理は継続（Firehoseイベントは一度きりのため）。
   - 個別イベントの処理失敗で全体を停止させない設計。
   - 詳細なエラーログとスタックトレース（debugレベル時）。

6. **グレースフルシャットダウン**
   - SIGINT（Ctrl+C）およびSIGTERMシグナルを捕捉。
   - `isShuttingDown` フラグによる2重実行防止。
   - シャットダウン手順:
     1. LabelerServerのクローズ
     2. データベースのクローズ
     3. プロセス終了

7. **ログ出力**
   - ログレベル: `debug`, `info`, `warn`, `error`
   - 環境変数 `LOG_LEVEL` で制御可能。
   - デフォルトは `info`。

## 出力するファイル構成
以下のファイルを作成するコードを提示してください。

1. **package.json**
   - 必要な `dependencies` と `devDependencies` を記述。
   - `type: "module"` を指定。

2. **tsconfig.json**
   - `module: "NodeNext"`, `target: "ES2022"`, `strict: true` 設定。

3. **.env.example**
   - `LABELER_DID` (ラベラーのDID) - 必須
   - `LABELER_SIGNING_KEY` (署名用秘密鍵) - 必須
   - `LABELER_PORT` (ラベラーサーバーのポート番号、デフォルト: 14831)
   - `LABELER_DB_PATH` (ラベラー用DBパス、デフォルト: labels.db)
   - `DB_FILE` (Like管理用DBパス、デフォルト: database.db)
   - `LOG_LEVEL` (ログレベル: debug/info/warn/error、デフォルト: info)

4. **src/config.ts**
   - 環境変数の読み込み。
   - `TRIGGER_MAP`: 投稿URIをキー、ラベル値を値とするオブジェクト定数を定義（サンプルデータを入れておく）。

5. **src/db.ts**
   - `better-sqlite3` を使用したDBラッパー。
   - テーブル初期化SQL。
   - `getAllLikes`, `addLike`, `removeLike`, `getTriggerUri` メソッドの実装。

6. **src/index.ts**
   - エントリーポイント。
   - `LabelerServer` の初期化と起動。
   - メモリキャッシュの初期化。
   - Jetstreamのセットアップとイベントリスナーの実装。
   - `emitLabel` 関数: `LabelerServer.createLabel()` を使用した実際のラベル発行処理。
   - グレースフルシャットダウン処理（SIGINT/SIGTERM対応）。
   - シャットダウン2重実行防止機構（`isShuttingDown` フラグ）。
   - ログレベルに応じた詳細なログ出力。

## コード生成の注意点
- エラーハンドリングを適切に行うこと。
  - ラベル発行失敗時もシステムを継続させる。
  - 個別イベント処理のエラーで全体を停止させない。
- コード内に日本語でわかりやすいコメントを入れること。
- `import` 文は正しく解決できるように記述すること。
- プリペアドステートメントを使用してDBパフォーマンスを最適化。
- グレースフルシャットダウンの実装:
  - シグナルハンドラー（SIGINT/SIGTERM）を設定。
  - シャットダウン処理の2重実行を防止。
  - リソース（LabelerServer、DB接続）を適切にクローズ。
- ログレベルによる出力制御を実装。
- 環境変数の必須チェックとデフォルト値の設定。
